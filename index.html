<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Генератор заявки — пример</title>
<style>
  :root{
    --bg:#fafafa; --card:#fff; --text:#111; --muted:#666; --accent:#2563eb;
  }
  [data-theme="dark"]{
    --bg:#0b1220; --card:#0f1724; --text:#e6eef8; --muted:#9fb0cf; --accent:#60a5fa;
  }
  body{font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue"; background:var(--bg); color:var(--text); margin:0; padding:24px;}
  .container{max-width:1000px;margin:0 auto;display:grid;grid-template-columns:1fr 360px;gap:20px;}
  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.08);}
  h1{margin:0 0 12px 0;font-size:20px;}
  label{display:block;margin:12px 0 6px;font-size:13px;color:var(--muted);}
  input[type=text], input[type=date], select, textarea{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #ddd;background:transparent;color:var(--text);box-sizing:border-box;}
  textarea{min-height:120px;resize:vertical;}
  .buttons{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;}
  button{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;}
  button.secondary{background:transparent;color:var(--accent);border:1px solid rgba(0,0,0,0.06);}
  .muted{color:var(--muted);font-size:13px;}
  .stepper{display:flex;gap:8px;margin-bottom:12px;}
  .step{padding:6px 10px;border-radius:8px;background:rgba(0,0,0,0.03);font-size:13px;}
  .hidden{display:none;}
  .controls{display:flex;gap:8px;align-items:center;justify-content:space-between;}
  .right .muted{font-size:12px;}
  .preview{white-space:pre-wrap;background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent);padding:10px;border-radius:8px;border:1px dashed rgba(0,0,0,0.04);min-height:120px;overflow:auto;}
  .small{font-size:12px;}
  .flex{display:flex;gap:8px;align-items:center;}
  .copy-btn{padding:6px 10px;border-radius:8px;background:rgba(0,0,0,0.06);border:none;cursor:pointer;}
  @media (max-width:900px){ .container{grid-template-columns:1fr;} }
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div class="controls">
      <h1>Генератор заявки</h1>
      <div class="flex">
        <label class="small muted" for="themeToggle">Тема</label>
        <select id="themeToggle" title="Тема">
          <option value="light">Светлая</option>
          <option value="dark">Тёмная</option>
        </select>
      </div>
    </div>

    <div class="stepper" id="steps">
      <div class="step" data-step="1">I. Основная</div>
      <div class="step" data-step="2">II. Вопросы</div>
      <div class="step" data-step="3">III. OOC</div>
    </div>

    <form id="form">
      <!-- Step 1 -->
      <div class="form-step" data-step="1">
        <label>Имя Фамилия: * <input type="text" name="fullname" required></label>
        <label>Дата рождения: * <input type="date" name="dob" required></label>
        <label>Пол: *
          <select name="gender" required>
            <option value="">— Выберите —</option>
            <option>Мужской</option>
            <option>Женский</option>
          </select>
        </label>
        <label>Номер телефона: * <input type="text" name="phone" required></label>
        <label>Адрес проживания: * <input type="text" name="address" required></label>
      </div>

      <!-- Step 2 -->
      <div class="form-step hidden" data-step="2">
        <label>Расовая/этническая принадлежность: * <input type="text" name="ethnicity" required></label>
        <label>Юридический статус в стране: * <input type="text" name="status" required></label>
        <label>Ваше образование: * <input type="text" name="education" required></label>
        <label>История правонарушений: * <textarea name="crimes" required></textarea></label>
        <label>Разрешения и лицензии: <input type="text" name="licenses"></label>
        <label>Почему мы должны взять именно Вас? (мин. 50 слов) * <textarea name="why" id="why" required></textarea></label>
        <div class="flex"><div class="muted small">Слов: <span id="wordCount">0</span></div></div>
      </div>

      <!-- Step 3 -->
      <div class="form-step hidden" data-step="3">
        <label>Имя (игровое): * <input type="text" name="ic_name" required></label>
        <label>Возраст: * <input type="text" name="ic_age" required></label>
        <label>Часовой пояс: * <input type="text" name="timezone" required></label>
        <label>Квента персонажа: * <textarea name="bio" required></textarea></label>
        <label>Ссылка ВКонтакте: <input type="text" name="vk"></label>
      </div>

      <div class="buttons" style="margin-top:16px;">
        <button type="button" id="prevBtn" class="secondary">← Назад</button>
        <button type="button" id="nextBtn">Далее →</button>
        <button type="button" id="generateBtn" class="secondary">Сгенерировать BB-код</button>
        <button type="button" id="clearBtn" class="secondary">Очистить форму</button>
      </div>
    </form>
  </div>

  <div class="card right">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div class="muted">НАЗВАНИЕ ТЕМЫ</div>
        <div id="topicTitle" style="font-weight:600;margin:8px 0">[Дата] — Имя Фамилия</div>
      </div>
      <button class="copy-btn" id="copyTitle">Копировать название</button>
    </div>

    <hr style="margin:12px 0;border:none;border-top:1px solid rgba(0,0,0,0.06)">

    <div class="muted">Сгенерированный BB-код</div>
    <div id="bbPreview" class="preview" contenteditable="false">Здесь появится BB-код после генерации...</div>
    <div style="display:flex;gap:8px;margin-top:8px;">
      <button id="copyBB" class="copy-btn">Копировать BB-код</button>
      <button id="downloadBtn" class="copy-btn">Скачать .txt</button>
    </div>

    <hr style="margin:12px 0;border:none;border-top:1px solid rgba(0,0,0,0.06)">

    <div class="muted small">Проверьте данные перед генерацией. После генерации можно копировать.</div>
  </div>
</div>

<script>
(function(){
  const steps = Array.from(document.querySelectorAll('.form-step'));
  let current = 0;
  const update = ()=>{
    steps.forEach((s,i)=> s.classList.toggle('hidden', i!==current));
    document.getElementById('prevBtn').style.display = current===0?'none':'inline-block';
    document.getElementById('nextBtn').style.display = current===steps.length-1?'none':'inline-block';
  };
  update();

  document.getElementById('nextBtn').onclick = ()=>{
    // simple validation for current step
    const inputs = steps[current].querySelectorAll('input,select,textarea');
    for (let el of inputs){
      if (el.hasAttribute('required') && !el.value.trim()){
        el.focus();
        alert('Заполните обязательные поля в текущем блоке.');
        return;
      }
    }
    if (current < steps.length-1) current++;
    update();
  };
  document.getElementById('prevBtn').onclick = ()=>{
    if (current>0) current--;
    update();
  };

  // word count for 'why'
  const why = document.getElementById('why');
  const wc = document.getElementById('wordCount');
  function computeWords(text){
    return text.trim().length ? text.trim().split(/\s+/).length : 0;
  }
  if (why){
    why.addEventListener('input', ()=> wc.textContent = computeWords(why.value));
  }

  // theme toggle & persistence
  const themeSel = document.getElementById('themeToggle');
  const applyTheme = (t)=>{
    document.documentElement.setAttribute('data-theme', t==='dark' ? 'dark' : 'light');
    themeSel.value = t;
    localStorage.setItem('theme', t);
  };
  themeSel.addEventListener('change', ()=> applyTheme(themeSel.value));
  applyTheme(localStorage.getItem('theme') || 'light');

  // generate BB code
  function generateBB(formData){
    // simple mapping to BB layout. Customize as needed.
    const now = new Date();
    const dateStr = now.toLocaleDateString('ru-RU');
    const title = `[${dateStr}] ${formData.get('fullname') || 'Имя Фамилия'}`;
    const lines = [];
    lines.push(`[b]Имя Фамилия:[/b] ${formData.get('fullname') || ''}`);
    lines.push(`[b]Дата рождения:[/b] ${formData.get('dob') || ''}`);
    lines.push(`[b]Пол:[/b] ${formData.get('gender') || ''}`);
    lines.push(`[b]Телефон:[/b] ${formData.get('phone') || ''}`);
    lines.push(`[b]Адрес:[/b] ${formData.get('address') || ''}`);
    lines.push(`\n[hr]\n[b]Расовая/этническая принадлежность:[/b] ${formData.get('ethnicity') || ''}`);
    lines.push(`[b]Юридический статус:[/b] ${formData.get('status') || ''}`);
    lines.push(`[b]Образование:[/b] ${formData.get('education') || ''}`);
    lines.push(`[b]История правонарушений:[/b]\n${formData.get('crimes') || ''}`);
    lines.push(`[b]Разрешения/лицензии:[/b] ${formData.get('licenses') || ''}`);
    lines.push(`\n[quote][b]Почему мы должны взять именно Вас:[/b]\n${formData.get('why') || ''}[/quote]`);
    lines.push(`\n[hr]\n[b]OOC Имя:[/b] ${formData.get('ic_name') || ''}`);
    lines.push(`[b]Возраст:[/b] ${formData.get('ic_age') || ''}`);
    lines.push(`[b]Часовой пояс:[/b] ${formData.get('timezone') || ''}`);
    lines.push(`[b]Квента персонажа:[/b]\n${formData.get('bio') || ''}`);
    if (formData.get('vk')) lines.push(`\n[b]VK:[/b] ${formData.get('vk')}`);
    const bb = lines.join('\n\n');
    return {title, bb};
  }

  const form = document.getElementById('form');
  document.getElementById('generateBtn').addEventListener('click', ()=>{
    // validate entire form (required fields)
    const allInputs = form.querySelectorAll('input,textarea,select');
    for (let el of allInputs){
      if (el.hasAttribute('required') && !el.value.trim()){
        alert('Заполните все обязательные поля перед генерацией.');
        el.scrollIntoView({behavior:'smooth',block:'center'});
        el.focus();
        return;
      }
    }
    const fd = new FormData(form);
    const out = generateBB(fd);
    document.getElementById('topicTitle').textContent = out.title;
    document.getElementById('bbPreview').textContent = out.bb;
    // save last generation to localStorage
    localStorage.setItem('lastGeneratedTitle', out.title);
    localStorage.setItem('lastGeneratedBB', out.bb);
  });

  // copy buttons
  function copyText(text){
    navigator.clipboard.writeText(text).then(()=>{
      alert('Скопировано в буфер обмена');
    }).catch(()=>{ alert('Не удалось скопировать.'); });
  }
  document.getElementById('copyTitle').addEventListener('click', ()=>{
    copyText(document.getElementById('topicTitle').textContent);
  });
  document.getElementById('copyBB').addEventListener('click', ()=>{
    copyText(document.getElementById('bbPreview').textContent);
  });

  // download .txt
  document.getElementById('downloadBtn').addEventListener('click', ()=>{
    const content = document.getElementById('bbPreview').textContent || '';
    const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'bbcode.txt'; document.body.appendChild(a);
    a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  // clear form
  document.getElementById('clearBtn').addEventListener('click', ()=>{
    if (!confirm('Очистить форму?')) return;
    form.reset();
    wc.textContent = '0';
    document.getElementById('bbPreview').textContent = 'Здесь появится BB-код после генерации...';
    document.getElementById('topicTitle').textContent = '[Дата] — Имя Фамилия';
    localStorage.removeItem('formData');
  });

  // autosave form to localStorage periodically / on change
  function saveForm(){
    const data = {};
    new FormData(form).forEach((v,k)=> data[k]=v);
    localStorage.setItem('formData', JSON.stringify(data));
  }
  form.addEventListener('input', ()=> {
    computeWords(why.value);
    saveForm();
  });

  // load saved form
  const saved = localStorage.getItem('formData');
  if (saved){
    try{
      const obj = JSON.parse(saved);
      for (let k in obj){
        const el = form.elements[k];
        if (el) el.value = obj[k];
      }
      if (why) wc.textContent = computeWords(why.value);
    }catch(e){}
  }

  // initialize prev button visibility
  update();
})();
</script>
</body>
</html>
